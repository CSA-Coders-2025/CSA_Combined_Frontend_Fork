<style>
    /* TYPOGRAPHY STUFF ================= */
    h3 {
        margin-top: 0px;
        padding-top: 0px;
    }

    h1 {
        white-space: nowrap;
    }

    /* OTHER STUFF ====================== */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #111111;
        color: white;

        /* delete later */
        /* margin: 50px; */
        margin: 0px;
    }

    .profile-pic {
        border-radius: 50%;
        height: 125px;
        width: 125px;
    }

    /* SIDEBAR LINK STYLES */
    .sidebar ul {
        display: flex;
        flex-direction: column;
        align-items: start;
        list-style-type: none;
        padding-left: 0px;
    }

    .sidebar ul li a {
        position: relative;
        display: block;
        padding: 4px 0;
        font-family: Lato, sans-serif;
        color: #ecf0f1;
        text-decoration: none;
        transition: 0.5s;
        font-weight: bolder;
    }

    .sidebar ul li a::after {
        position: absolute;
        content: "";
        top: 100%;
        left: 0;
        width: 100%;
        height: 3px;
        background: #3498db;
        transform: scaleX(0);
        transform-origin: right;
        transition: transform 0.5s;
    }

    .sidebar ul li a:hover {
        color: #95a5a6;
    }

    .sidebar ul li a:hover::after {
        transform: scaleX(1);
        transform-origin: left;
    }

    .sidebar .active-tab {
        color: #0071e3;
    }
</style>

<!-- <div class="container">
    <div class="sidebar">
        {% include sidebar.html %}
    </div>
</div> -->

<img src="#" alt="" class="profile-pic" id="headerPfp">
<h1 id="headerName">Welcome,<br /> User</h1>
<!-- nav links -->
<ul>
    <!-- these will show if you ARE logged in -->
    <li id="profile-link">
        <h3><a href="{{site.baseurl}}/profile_aesthetihawk">Profile Settings</a></h3>
    </li>

    <li id="student-toolkit-link">
        <h3><a href="{{site.baseurl}}/student_aesthetihawk" class="active-tab">Student Toolkit</a></h3>
    </li>

    <li id="teacher-toolkit-link">
        <!-- this only shows if you are a teacher (your user has the teacher role) -->
        <h3><a href="#">Teacher Toolkit</a></h3>
    </li>

    <li id="calendar-link">
        <h3><a href="{{site.baseurl}}/student/calendar">Calendar</a></h3>
    </li>

    <li id="sign-out-link">
        <h3><a href="{{site.baseurl}}/logoutjava">Sign Out</a></h3>
    </li>

    <!-- these will show if you're NOT logged in -->
    <li id="sign-in-link">
        <h3><a href="{{site.baseurl}}/toolkit-login">Sign In</a></h3>
    </li>

    <li id="sign-up-link">
        <h3><a href="{{site.baseurl}}/signup">Sign Up</a></h3>
    </li>
</ul>

<!-- link controller (show and hide relevant links depending on the user's login status: logged in or logged out) -->
<script type="module">
    // use this to configure the API links depending on if you're running on local host or not
    import { javaURI, fetchOptions } from '{{site.baseurl}}/assets/js/api/config.js';

    document.addEventListener('DOMContentLoaded', function () {
        getCredentialsJava()
            .then(data => {
                // these only show if you ARE logged in
                const profileLink = document.getElementById('profile-link');
                const studentToolkitLink = document.getElementById('student-toolkit-link');
                const teacherToolkitLink = document.getElementById('teacher-toolkit-link');
                const calendarLink = document.getElementById('calendar-link');
                const signOutLink = document.getElementById('sign-out-link');

                // these ones only show if you are NOT logged in
                const signInLink = document.getElementById('sign-in-link');
                const signUpLink = document.getElementById('sign-up-link');

                // these are the sidebar data which should change
                const name = document.getElementById('headerName');
                const pfp = document.getElementById('headerPfp');

                if (data) { // the user is authenticated
                    // hide sign-in link and sign-up link because the user doesn't need it anymore
                    signInLink.style.display = 'none';
                    signUpLink.style.display = 'none';

                    // only when the user is logged in can they access the toolkits
                    // profileLink.innerHTML = `<a href="{{site.baseurl}}/profilejava">Profile</a>`;
                    // studentToolkitLink.innerHTML = `<a href="{{site.baseurl}}/student">Student Toolkit</a>`;
                    // calendarLink.innerHTML = `<a href="{{site.baseurl}}/student/calendar">Calendar</a>`;
                    profileLink.style.display = 'block';
                    studentToolkitLink.style.display = 'block';
                    calendarLink.style.display = 'block';

                    // if the person who is logged in has the teacher role, display "Teacher Toolkit"
                    const isTeacher = data.roles.some(role => role.name === 'ROLE_TEACHER');
                    if (isTeacher) {
                        // teacherToolkitLink.innerHTML = `<a href="{{site.baseurl}}/teacher">Teacher Toolkit</a>`;
                        teacherToolkitLink.style.display = 'block';
                    }
                    else {
                        teacherToolkitLink.style.display = 'none';
                    }

                    // because the user is logged in, show the sign out link
                    // logoutLink.innerHTML = `<a href="{{site.baseurl}}/logoutjava">Logout of Toolkit</a>`;
                    signOutLink.style.display = 'block';

                    // now we should change the info in the sidebar like the name and the PFP
                    name.innerHTML = "Welcome, <br/>" + data.name;
                    headerPfp.src = javaURI + data.pfp;
                    console.log(javaURI);
                }
                else { // user isn't authenticated
                    // show signup and login links
                    // signupLink.innerHTML = `<a href="{{site.baseurl}}/signup">Signup for Toolkit</a>`;
                    // loginLink.innerHTML = `<a href="{{site.baseurl}}/toolkit-login">Login to Toolkit</a>`;
                    signInLink.style.display = 'block';
                    signUpLink.style.display = 'block';

                    // hide everything else
                    profileLink.style.display = 'none';
                    studentToolkitLink.style.display = 'none';
                    teacherToolkitLink.style.display = 'none';
                    calendarLink.style.display = 'none';
                    signOutLink.style.display = 'none';
                }
            })
            .catch(err => {
                console.error("Error fetching credentials: ", err);
            });
    });

    // this calls the backend and gets the user credentials
    // it returns the data
    function getCredentialsJava() {
        const URL = javaURI + '/api/person/get';
        return fetch(URL, fetchOptions)
            .then(response => {
                if (response.status !== 200) {
                    console.error("HTTP status code: " + response.status);
                    return null;
                }
                return response.json();
            })
            .then(data => {
                if (data === null) return null;
                console.log(data);
                return data;
            })
            .catch(err => {
                console.error("Fetch error: ", err);
                return null;
            });
    }

    function getCredentialsJavaSimulation() {
        return true;
    }
</script>