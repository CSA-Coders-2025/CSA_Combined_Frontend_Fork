---
title: Profile Settings
layout: aesthetihawk
active_tab: profile
---

<style>
    /* Shake animation for Save button */
    @keyframes shake {
        0% {
            transform: translateX(0);
        }

        25% {
            transform: translateX(-15px);
        }

        50% {
            transform: translateX(15px);
        }

        75% {
            transform: translateX(-15px);
        }

        100% {
            transform: translateX(0);
        }
    }

    .shake-animation {
        animation: shake 0.3s ease-in-out;
    }
</style>


<form id="profileSettingsForm">
    <!-- Personal Information Section -->
    <div class="bg-neutral-800 rounded-lg shadow-md p-6 mb-6 border-neutral-700 border">
        <h2 class="text-xl font-semibold mb-6">Personal Information</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Full Name -->
            <div>
                <label for="nameChangeInput" class="block text-sm font-medium text-gray-300 mb-1">Full
                    Name</label>
                <input type="text" id="nameChangeInput" name="fullName"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    value="" onchange="checkForChanges()">
            </div>

            <!-- User ID -->
            <div>
                <label for="uidChangeInput" class="block text-sm font-medium text-gray-300 mb-1">User
                    ID</label>
                <input type="text" id="uidChangeInput" name="userId"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    value="" onchange="checkForChanges()">
            </div>

            <!-- Email -->
            <div>
                <label for="emailChangeInput" class="block text-sm font-medium text-gray-300 mb-1">Email
                    Address</label>
                <input type="email" id="emailChangeInput" name="email"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    value="" onchange="checkForChanges()">
            </div>

            <!-- Student ID -->
            <div>
                <label for="studentId" class="block text-sm font-medium text-gray-300 mb-1">Student
                    ID (7
                    digits)</label>
                <input type="text" id="studentId" name="studentId"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    value="1234567" maxlength="7" pattern="\d{7}" onchange="checkForChanges()">
            </div>

            <!-- Kasm Server Toggle -->
            <div class="flex items-center">
                <label for="kasmToggle" class="flex items-center cursor-pointer">
                    <div class="relative">
                        <input type="checkbox" id="kasmToggle" class="sr-only" onchange="checkForChanges()">
                        <div class="block bg-neutral-600 w-14 h-8 rounded-full"></div>
                        <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition transform">
                        </div>
                    </div>
                    <div class="ml-3 text-sm font-medium text-gray-300">
                        Enable Kasm Server
                    </div>
                </label>
            </div>

            <!-- Password Change -->
            <div>
                <label for="password" class="block text-sm font-medium text-gray-300 mb-1">New
                    Password</label>
                <input type="password" id="password" name="password"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    placeholder="Enter new password" onchange="checkForChanges()">
            </div>
        </div>
    </div>

    <!-- Classes Section -->
    <div class="bg-neutral-800 rounded-lg shadow-md p-6 mb-6 border-neutral-700 border">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Classes</h2>
            <button type="button" id="addClassBtn"
                class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 focus:outline-none"
                onclick="addClass()">
                Add Class
            </button>
        </div>

        <div id="classesContainer">
            <!-- Classes will be added here dynamically -->
            <div class="class-entry mb-4 p-4 border rounded-lg border-neutral-700 border">
                <div class="flex flex-col md:flex-row md:space-x-4 mb-2">
                    <div class="flex-grow mb-2 md:mb-0">
                        <label class="block text-sm font-medium text-gray-300 mb-1">Class
                            Name</label>
                        <input type="text"
                            class="class-name w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            value="Computer Science" onchange="checkForChanges()">
                    </div>
                    <div class="w-full md:w-1/3">
                        <label class="block text-sm font-medium text-gray-300 mb-1">Year</label>
                        <select
                            class="class-year w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            onchange="checkForChanges()">
                            <option>2025</option>
                            <option>2026</option>
                            <option>2027</option>
                            <option>2028</option>
                        </select>
                    </div>
                </div>
                <button type="button" class="text-red-500 hover:text-red-700 text-sm font-medium"
                    onclick="removeClass(this)">
                    Remove
                </button>
            </div>
        </div>
    </div>
</form>

<div class="flex justify-between items-center mb-8">
    <button id="saveChangesBtn" disabled
        class="px-6 py-2 bg-neutral-300 text-gray-500 cursor-not-allowed rounded-lg transition-all duration-300"
        onclick="saveChanges()">
        Save Changes
    </button>
</div>

<!-- Unsaved Changes Alert -->
<div id="unsavedChangesAlert"
    class="hidden fixed bottom-4 right-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-md">
    <div class="flex items-center">
        <div class="py-1">
            <svg class="h-6 w-6 text-red-500 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
        </div>
        <div>
            <p class="font-bold">You have unsaved changes</p>
            <p class="text-sm">Please save your changes before leaving.</p>
        </div>
    </div>
</div>
<!-- content here -->

<style>
    /* Toast base (off-screen to the right + invisible) */
    #unsavedChangesAlert {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        transform: translateX(120%);
        opacity: 0;
        transition: transform 0.4s ease, opacity 0.4s ease;
        z-index: 50;
    }

    /* Toast “show” state (on-screen + visible) */
    #unsavedChangesAlert.show {
        transform: translateX(0);
        opacity: 1;
    }

    /* Shake animation for Save button */
    @keyframes shake {
        0% {
            transform: translateX(0);
        }

        25% {
            transform: translateX(-15px);
        }

        50% {
            transform: translateX(15px);
        }

        75% {
            transform: translateX(-15px);
        }

        100% {
            transform: translateX(0);
        }
    }

    .shake-animation {
        animation: shake 0.3s ease-in-out;
    }

    /* Close-button styling */
    #unsavedChangesAlert button.close {
        position: absolute;
        top: 0.25rem;
        right: 0.25rem;
        background: transparent;
        border: none;
        font-size: 1rem;
        cursor: pointer;
    }
</style>

<!-- icons -->
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

<!-- js tilt feature -->
<script src="{{ site.baseurl }}/scripts/tilt.js"></script>

<script type="module">
    import { javaURI, fetchOptions } from '{{site.baseurl}}/assets/js/api/config.js';
    import { pythonURI } from '{{site.baseurl}}/assets/js/api/config.js';
    import { putUpdate, postUpdate, deleteData, logoutUserJava } from "{{site.baseurl}}/assets/js/api/profile.js";

    // this runs on page load
    document.addEventListener("DOMContentLoaded", async () => {
        try {
            await window.loadUserData();
        } catch (error) {
            console.error("Error initializing user data:", error.message);
        }
    });

    // Function to continuously fetch user data until all values are loaded
    async function continuouslyLoadUserData() {
        const nameInput = document.getElementById("nameChangeInput");
        const uidInput = document.getElementById("uidChangeInput");
        const emailInput = document.getElementById("emailChangeInput");

        // Helper function to check if all values are loaded
        function isDataLoaded() {
            return (
                nameInput.value !== "Loading name..." &&
                uidInput.value !== "Loading UID..." &&
                emailInput.value !== "Loading email..."
            );
        }

        // Retry logic
        async function fetchAndUpdateData() {
            try {
                // Fetch name and UID from Python backend
                const name = await window.fetchName();
                const uid = await window.fetchUid();

                // Fetch email from Java backend
                const email = await window.fetchEmail();

                // Update placeholders if data is available
                if (name) nameInput.value = name;
                if (uid) uidInput.value = uid;
                if (email) emailInput.value = email;

                // Log success if all data is loaded
                if (isDataLoaded()) {
                    console.log("All user data loaded successfully.");
                    return; // Stop retrying
                }
            } catch (error) {
                console.error("Error fetching user data:", error.message);
            }

            // Retry after 3 seconds if data is still not fully loaded
            setTimeout(fetchAndUpdateData, 3000);
        }

        // Start the first fetch attempt
        fetchAndUpdateData();
    }

    // Call the function on page load
    document.addEventListener("DOMContentLoaded", continuouslyLoadUserData);

    // make it run constantly to check for esc key press
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            document.getElementById('change-pfp').style.visibility = 'hidden';
            document.getElementById('change-class').style.visibility = 'hidden';
        }
    });

    // Attach the function to the global window object
    window.openChangePfpModal = function () {
        const changePfpBox = document.getElementById('change-pfp');
        console.log("Change pfp button clicked");
        if (changePfpBox) {
            changePfpBox.style.visibility = 'visible'; // Make the modal visible
        } else {
            console.error('Change PFP modal not found in the DOM.');
        }
    };

    window.changeProfilePictureWithPath = async function (imagePath) {
        try {
            // Fetch the image and convert it to a Blob
            const response = await fetch(imagePath);
            const blob = await response.blob();

            // Convert the Blob to a base64 string
            const base64String = await convertToBase64(blob);

            // Send the base64 image to the backend
            await sendProfilePicture(base64String);
            console.log('Profile picture updated to steve.png successfully!');
        } catch (error) {
            console.error('Error updating profile picture to steve.png:', error.message);
        }
    };

    // loading the user data to display
    window.loadUserData = async function () {
        try {
            // Fetch name and UID from Python backend
            const name = await window.fetchName();
            const uid = await window.fetchUid();

            // Fetch email and Kasm status from Java backend
            const email = await window.fetchEmail();
            const kasm = await window.fetchKasmStatus();

            // Update the name and UID placeholders
            const nameInput = document.getElementById("nameChangeInput");
            const uidInput = document.getElementById("uidChangeInput");
            const emailInput = document.getElementById("emailChangeInput");

            if (name) {
                nameInput.value = name;
                await window.changeSteve();
            } else {
                nameInput.value = "Failed to load name";
            }

            if (uid) {
                uidInput.value = uid;
            } else {
                uidInput.value = "Failed to load UID";
            }

            if (email) {
                emailInput.value = email;
            } else {
                emailInput.value = "Failed to load email";
            }

            // Update the Kasm status
            const kasmCheckbox = document.getElementById("kasmNeeded");
            if (kasmCheckbox) { // Ensure the checkbox exists
                kasmCheckbox.checked = kasm; // Set the checkbox state directly
                document.getElementById("kasm").textContent = kasm ? "Kasm Enabled" : "Kasm Disabled"; // Update the label
            } else {
                console.error("Kasm checkbox not found in the DOM.");
            }
        } catch (error) {
            console.error("Error setting placeholders:", error.message);
        }
    };

    // FETCH COMMANDS ========
    window.fetchName = async function () {
        const URL = pythonURI + "/api/id"; // Adjusted endpoint

        try {
            const response = await fetch(URL, fetchOptions);
            if (!response.ok) {
                throw new Error(`Failed to fetch Name: ${response.status}`);
            }

            const data = await response.json();
            return data.name;
        } catch (error) {
            console.error('Error fetching Name:', error.message);
            return null;
        }
    };

    window.fetchUid = async function () {
        const URL = pythonURI + "/api/id"; // Adjusted endpoint

        try {
            const response = await fetch(URL, fetchOptions);
            if (!response.ok) {
                throw new Error(`Failed to fetch UID: ${response.status}`);
            }

            const data = await response.json();
            return data.uid;
        } catch (error) {
            console.error('Error fetching UID:', error.message);
            return null;
        }
    };

    window.fetchUid = async function () {
        const URL = pythonURI + "/api/id"; // Adjusted endpoint

        try {
            const response = await fetch(URL, fetchOptions);
            if (!response.ok) {
                throw new Error(`Failed to fetch UID: ${response.status}`);
            }

            const data = await response.json();
            return data.uid;
        } catch (error) {
            console.error('Error fetching UID:', error.message);
            return null;
        }
    };

    window.fetchEmail = async function () {
        const URL = javaURI + "/api/person/get"; // Adjusted endpoint

        try {
            const response = await fetch(URL, fetchOptions);

            if (!response.ok) {
                throw new Error(`Failed to fetch UID: ${response.status}`);
            }

            const data = await response.json();
            return data.email;
        }
        catch (error) {
            document.getElementById("email").textContent = "Failed to load. Are you logged in?";
            console.error('Error fetching UID:', error.message);
            return null;
        }
    };

    window.fetchKasmStatus = async function () {
        const URL = javaURI + "/api/person/get"; // Adjusted endpoint

        try {
            const response = await fetch(URL, fetchOptions);

            if (!response.ok) {
                throw new Error(`Failed to fetch kasm_server_needed: ${response.status}`);
            }

            const userData = await response.json();
            const kasmServerNeeded = userData.kasmServerNeeded

            // Update checkbox state based on fetched value
            if (kasmServerNeeded) {
                document.getElementById("kasm").textContent = "Kasm Enabled";
                document.getElementById("kasmNeeded").checked = true; // Set checkbox to checked
            }
            else {
                document.getElementById("kasm").textContent = "Kasm Disabled";
                document.getElementById("kasmNeeded").checked = false; // Set checkbox to unchecked
            }

            return kasmServerNeeded;
        } catch (error) {
            console.error('Error fetching kasm_server_needed:', error.message);
            return null;
        }
    }


    // UPDATE COMMANDS =======
    window.changeName = async function (event) {
        event.preventDefault(); // Prevent the form from refreshing the page

        // Ensure the input element is selected
        const nameChangeInput = document.getElementById("nameChangeInput");
        if (!nameChangeInput) {
            console.error("Input element not found.");
            return;
        }

        // Get value from the input field
        const name = nameChangeInput.value.trim(); // Trim to remove accidental spaces
        if (!name) {
            console.error("Name input is empty.");
            return;
        } else {
            console.log("Name input:", name);
        }

        // Define URLs for both backends
        const pythonURL = pythonURI + "/api/user";
        const javaURL = javaURI + "/api/person/update";

        // Define options for both requests
        const pythonOptions = {
            URL: pythonURL,
            body: { name },
            message: 'name-message',
            callback: () => {
                console.log('Name updated successfully in Python backend!');
            }
        };

        const javaOptions = {
            URL: javaURL,
            body: { name },
            callback: () => {
                console.log('Name updated successfully in Java backend!');
            }
        };

        try {
            // Send requests to both backends
            await Promise.all([
                putUpdate(pythonOptions),
                postUpdate(javaOptions)
            ]);

            // Update the name field in the UI
            window.updateNameField(name);
            console.log('Name updated successfully in both backends!');
            window.location.reload();
        } catch (error) {
            console.error('Error updating Name:', error.message);
            document.getElementById('name-message').textContent = 'Error updating Name: ' + error.message;
        }
    };

    window.updateNameField = async function (name) {
        const nameElement = document.getElementById("name");
        if (nameElement) {
            nameElement.textContent = name;
        } else {
            console.error("Name element not found.");
        }
    };

    window.changeUid = async function (event) {
        const uid = document.getElementById("uidChangeInput").value.trim(); // Get and trim input value

        // send the post request
        if (uid) {
            const URL = pythonURI + "/api/user"; // Adjusted endpoint

            const options = {
                URL,
                body: { uid },
                message: 'uid-message', // Adjust the message area as needed
                callback: () => {
                    alert("You updated your Github ID, so you will automatically be logged out. Be sure to remember your new github id to log in!");
                    console.log('UID updated successfully!');
                    window.updateUidField(uid);
                    window.location.href = '{{site.baseurl}}/duallogin';
                }
            };

            try {
                await putUpdate(options);
            } catch (error) {
                console.error('Error updating UID:', error.message);
                document.getElementById('uid-message').textContent = 'Error updating UID: ' + error.message;
            }
        }
        document.getElementById("uid").textContent = uid; //reload the content

    }


    window.changeEmail = async function (event) {
        event.preventDefault(); // Prevent the form from refreshing the page

        const email = document.getElementById("emailChangeInput").value.trim(); // Get and trim input value

        // send the post request
        if (email) {
            const URL = javaURI + "/api/person/update";
            const options = {
                URL,
                body: { email },
                callback: () => {
                    console.log('Email updated successfully!');
                }
            };
            try {
                await postUpdate(options);
            } catch (error) {
                console.error('Error updating email:', error.message);
            }
        }

        document.getElementById("email").textContent = email; //reload the content
    }

    window.changePassword = async function (event) {
        event.preventDefault(); // Prevent the form from refreshing the page

        const password = document.getElementById("passwordChangeInput").value.trim(); // Get and trim input value

        if (password) {
            const URL = pythonURI + "/api/user"; // Adjusted endpoint

            const options = {
                URL,
                body: { password },
                message: 'password-message', // Adjust the message area as needed
                callback: () => {
                    console.log('Password updated successfully!');
                    window.location.href = '{{site.baseurl}}/duallogin';
                }
            };

            try {
                alert("You updated your password, so you will automatically be logged out. Be sure to remember your password!");
                await putUpdate(options);
                await logoutUser();
            } catch (error) {
                console.error('Error updating password:', error.message);
                document.getElementById('password-message').textContent = 'Error updating password: ' + error.message;
            }
        }
    }

    window.changeKasmServerStatus = async function (event) {
        // select the checkbox and scan for updates (did they check or uncheck it?)
        const checkbox = event.target;
        const newKasmServerNeeded = checkbox.checked;

        const URL = javaURI + "/api/person/update"; // Adjusted endpoint

        // newKasmServerNeeded is a boolean, so you can just send it directly
        const options = {
            URL,
            body: { kasmServerNeeded: newKasmServerNeeded },
            callback: () => {
                console.log('Kasm Server Needed updated successfully!');
            }
        };
        try {
            await postUpdate(options);
        } catch (error) {
            console.error('Error updating kasm_server_needed:', error.message);
        }

        // Update checkbox state text based on new value
        if (newKasmServerNeeded) {
            document.getElementById("kasm").textContent = "Kasm Enabled";
        } else {
            document.getElementById("kasm").textContent = "Kasm Disabled";
        }
    }

    window.changeClass = async function (event) {
        event.preventDefault(); // Prevent the form from refreshing the page
        // change the class info p box
        const classInput = document.getElementById("classInput").value;
        const classInputYear = document.getElementById("classInputYear").value;
        const classDisplayedInfo = document.getElementById("classDisplayedInfo");
        classDisplayedInfo.textContent = classInput + " " + classInputYear;
    }


    window.changeProfilePicture = async function (event) {
        event.preventDefault(); // Prevent the form from refreshing the page

        // select the file
        const fileInput = document.getElementById('profilePictureInput');
        const file = fileInput.files[0];

        // all this does is update the image in the sidebar (doesnt actually send img to backend)
        if (file) {
            const reader = new FileReader();
            reader.onload = function () {
                const profileImageBox = document.getElementById('headerPfp');
                profileImageBox.innerHTML = `<img src="${reader.result}" alt="Profile Picture">`;
            };
            reader.readAsDataURL(file);
        }
        if (!file) return;

        // this is the code that ACTUALLY sends the file to the backend
        try {
            const base64String = await convertToBase64(file);
            await sendProfilePicture(base64String);
            console.log('Profile picture uploaded successfully!');
        } catch (error) {
            console.error('Error uploading profile picture:', error.message);
        }

        await new Promise(resolve => setTimeout(resolve, 250));
        window.location.reload();
    }

    // helper function to convert a file to base64 for payload
    async function convertToBase64(fileOrBlob) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
            reader.readAsDataURL(fileOrBlob);
        });
    }

    async function sendProfilePicture(base64String) {
        const URL = javaURI + "/api/person/update"; // Adjust endpoint as needed

        // Create options object for PUT request
        const options = {
            URL,
            body: { pfp: base64String },
            message: 'profile-message', // Adjust the message area as needed
            callback: () => {
                console.log('Profile picture uploaded successfully!');
            }
        };

        try {
            await postUpdate(options);
        } catch (error) {
            console.error('Error uploading profile picture:', error.message);
        }
    }
</script>

<script>
    // Store original form values
    let originalValues = {};
    let formChanged = false;

    // how long toast stays (ms)
    const toastDuration = 10000;

    // Initialize the form
    document.addEventListener('DOMContentLoaded', function () {
        // Store original values
        saveOriginalValues();

        // Set up toggle switch
        const toggle = document.querySelector('#kasmToggle');
        const toggleDot = document.querySelector('.dot');

        toggle.addEventListener('change', function () {
            if (this.checked) {
                toggleDot.classList.add('translate-x-3');
                toggle.classList.add('bg-blue-600');
            } else {
                toggleDot.classList.remove('translate-x-3');
                toggle.classList.remove('bg-blue-600');
            }
        });

        // Set up beforeunload event
        window.addEventListener('beforeunload', function (e) {
            if (formChanged) {
                showUnsavedChangesAlert();
            }
        });
    });

    // Save original form values
    function saveOriginalValues() {
        const form = document.getElementById('profileSettingsForm');
        const inputs = form.querySelectorAll('input, select');

        inputs.forEach(input => {
            if (input.type === 'checkbox') {
                originalValues[input.id] = input.checked;
            } else {
                originalValues[input.id] = input.value;
            }
        });

        // Save original class entries
        const classEntries = document.querySelectorAll('.class-entry');
        originalValues.classEntries = [];

        classEntries.forEach((entry, index) => {
            originalValues.classEntries[index] = {
                name: entry.querySelector('.class-name').value,
                year: entry.querySelector('.class-year').value
            };
        });
    }

    // Check if form values have changed
    function checkForChanges() {
        const form = document.getElementById('profileSettingsForm');
        const inputs = form.querySelectorAll('input, select');
        const saveButton = document.getElementById('saveChangesBtn');

        formChanged = false;

        // Check standard inputs
        inputs.forEach(input => {
            if (input.type === 'checkbox') {
                if (originalValues[input.id] !== input.checked) {
                    formChanged = true;
                }
            } else if (input.id && originalValues[input.id] !== undefined) {
                if (originalValues[input.id] !== input.value) {
                    formChanged = true;
                }
            }
        });

        // Check class entries
        const classEntries = document.querySelectorAll('.class-entry');
        if (classEntries.length !== originalValues.classEntries.length) {
            formChanged = true;
        } else {
            classEntries.forEach((entry, index) => {
                const name = entry.querySelector('.class-name').value;
                const year = entry.querySelector('.class-year').value;

                if (index >= originalValues.classEntries.length ||
                    originalValues.classEntries[index].name !== name ||
                    originalValues.classEntries[index].year !== year) {
                    formChanged = true;
                }
            });
        }

        // Update save button
        if (formChanged) {
            saveButton.disabled = false;
            saveButton.classList.remove('bg-neutral-300', 'text-neutral-500', 'cursor-not-allowed');
            saveButton.classList.add('bg-indigo-500', 'text-white', 'hover:bg-indigo-600');
        } else {
            saveButton.disabled = true;
            saveButton.classList.add('bg-neutral-300', 'text-neutral-500', 'cursor-not-allowed');
            saveButton.classList.remove('bg-indigo-500', 'text-white', 'hover:bg-indigo-600');
        }
    }

    // Add new class
    function addClass() {
        const container = document.getElementById('classesContainer');
        const classEntry = document.createElement('div');
        classEntry.className = 'class-entry mb-4 p-4 border border-gray-700 rounded-lg';

        classEntry.innerHTML = `
                    <div class="flex flex-col md:flex-row md:space-x-4 mb-2">
                        <div class="flex-grow mb-2 md:mb-0">
                            <label class="block text-sm font-medium text-neutral-300 mb-1">Class Name</label>
                            <input type="text" 
                                class="class-name w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="Enter class name" onchange="checkForChanges()">
                        </div>
                        <div class="w-full md:w-1/3">
                            <label class="block text-sm font-medium text-neutral-300 mb-1">Year</label>
                            <select class="class-year w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" onchange="checkForChanges()">
                                <option>2025</option>
                                <option>2026</option>
                                <option>2027</option>
                                <option>2028</option>
                            </select>
                        </div>
                    </div>
                    <button type="button" class="text-red-500 hover:text-red-700 text-sm font-medium" onclick="removeClass(this)">
                        Remove
                    </button>
                `;

        container.appendChild(classEntry);
        checkForChanges();
    }

    // Remove class
    function removeClass(button) {
        const classEntry = button.closest('.class-entry');
        classEntry.remove();
        checkForChanges();
    }

    // show toast, auto-hide, allow manual close
    function showUnsavedChangesAlert() {
        const toast = document.getElementById('unsavedChangesAlert');
        const saveButton = document.getElementById('saveChangesBtn');

        // trigger reflow so shake always retriggers
        saveButton.classList.remove('shake-animation');
        void saveButton.offsetWidth;
        saveButton.classList.add('shake-animation');

        // slide-in toast
        toast.classList.add('show');

        // clear any existing timeout
        if (toast.hideTimeout) clearTimeout(toast.hideTimeout);

        // auto-hide after duration
        toast.hideTimeout = setTimeout(() => {
            toast.classList.remove('show');
        }, toastDuration);
    }

    // close button handler
    document
        .getElementById('unsavedChangesAlert')
        .querySelector('button.close')
        .addEventListener('click', function () {
            const toast = document.getElementById('unsavedChangesAlert');
            toast.classList.remove('show');
            if (toast.hideTimeout) clearTimeout(toast.hideTimeout);
        });


    // Save changes
    function saveChanges() {
        // Here you would typically send data to the server
        // For now, we'll just update the originalValues
        saveOriginalValues();
        formChanged = false;

        const saveButton = document.getElementById('saveChangesBtn');
        saveButton.disabled = true;
        saveButton.classList.add('bg-neutral-300', 'text-neutral-500', 'cursor-not-allowed');
        saveButton.classList.remove('bg-indigo-500', 'text-white', 'hover:bg-indigo-600');

        // Show success message
        const originalButtonText = saveButton.innerHTML;
        saveButton.innerHTML = `
                    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Saved!
                `;

        setTimeout(() => {
            saveButton.innerHTML = originalButtonText;
        }, 2000);
    }
</script>