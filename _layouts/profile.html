---
title: Profile Settings
layout: aesthetihawk
active_tab: profile
---


<form id="profileSettingsForm">
    <!-- Personal Information Section -->
    <div class="bg-neutral-800 rounded-lg shadow-md p-6 mb-6 border-neutral-700 border">
        <h2 class="text-xl font-semibold mb-6">Personal Information</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Full Name -->
            <div>
                <label for="nameChangeInput" class="block text-sm font-medium text-gray-300 mb-1">Full
                    Name</label>
                <input type="text" id="nameChangeInput" name="fullName"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    value="" onchange="checkForChanges()">
            </div>

            <!-- User ID -->
            <div>
                <label for="uidChangeInput" class="block text-sm font-medium text-gray-300 mb-1">User
                    ID</label>
                <input type="text" id="uidChangeInput" name="userId"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    value="" onchange="checkForChanges()">
            </div>

            <!-- Email -->
            <div>
                <label for="emailChangeInput" class="block text-sm font-medium text-gray-300 mb-1">Email
                    Address</label>
                <input type="email" id="emailChangeInput" name="email"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    value="" onchange="checkForChanges()">
            </div>

            <!-- Student ID -->
            <div>
                <label for="studentId" class="block text-sm font-medium text-gray-300 mb-1">Student
                    ID (7
                    digits)</label>
                <input type="text" id="studentId" name="studentId"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    value="1234567" maxlength="7" pattern="\d{7}" onchange="checkForChanges()">
            </div>

            <!-- Kasm Server Toggle -->
            <div class="flex items-center">
                <label for="kasmChangeInput" class="flex items-center cursor-pointer">
                    <div class="relative">
                        <input type="checkbox" id="kasmChangeInput" class="sr-only" onchange="checkForChanges()">
                        <div class="block bg-neutral-600 w-14 h-8 rounded-full"></div>
                        <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition transform">
                        </div>
                    </div>
                    <div class="ml-3 text-sm font-medium text-gray-300">
                        Enable Kasm Server
                    </div>
                </label>
            </div>

            <!-- Password Change -->
            <div>
                <label for="password" class="block text-sm font-medium text-gray-300 mb-1">New
                    Password</label>
                <input type="password" id="password" name="password"
                    class="w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    placeholder="Enter new password" onchange="checkForChanges()">
            </div>
        </div>
    </div>

    <!-- Classes Section -->
    <div class="bg-neutral-800 rounded-lg shadow-md p-6 mb-6 border-neutral-700 border">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Classes</h2>
            <button type="button" id="addClassBtn"
                class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 focus:outline-none"
                onclick="addClass()">
                Add Class
            </button>
        </div>

        <div id="classesContainer">
            <!-- Classes will be added here dynamically -->
            <div class="class-entry mb-4 p-4 border rounded-lg border-neutral-700 border">
                <div class="flex flex-col md:flex-row md:space-x-4 mb-2">
                    <div class="flex-grow mb-2 md:mb-0">
                        <label class="block text-sm font-medium text-gray-300 mb-1">Class
                            Name</label>
                        <input type="text"
                            class="class-name w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            value="Computer Science" onchange="checkForChanges()">
                    </div>
                    <div class="w-full md:w-1/3">
                        <label class="block text-sm font-medium text-gray-300 mb-1">Year</label>
                        <select
                            class="class-year w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            onchange="checkForChanges()">
                            <option>2025</option>
                            <option>2026</option>
                            <option>2027</option>
                            <option>2028</option>
                        </select>
                    </div>
                </div>
                <button type="button" class="text-red-500 hover:text-red-700 text-sm font-medium"
                    onclick="removeClass(this)">
                    Remove
                </button>
            </div>
        </div>
    </div>
</form>

<div class="flex justify-between items-center mb-8">
    <button id="saveChangesBtn" disabled
        class="px-6 py-2 bg-neutral-300 text-gray-500 cursor-not-allowed rounded-lg transition-all duration-300"
        onclick="saveChanges()">
        Save Changes
    </button>
</div>

<style>
    /* Shake animation for Save button */
    @keyframes shake {
        0% {
            transform: translateX(0);
        }

        25% {
            transform: translateX(-15px);
        }

        50% {
            transform: translateX(15px);
        }

        75% {
            transform: translateX(-15px);
        }

        100% {
            transform: translateX(0);
        }
    }

    .shake-animation {
        animation: shake 0.3s ease-in-out;
    }
</style>

<!-- js tilt feature -->
<script src="{{ site.baseurl }}/scripts/tilt.js"></script>

<!-- toasts -->
<script type="module">
    // import the toast handler module
    import { showToast } from "{{site.baseurl}}/assets/js/Aesthetihawk/toastHandler.js";

    window.addEventListener('load', () => {
        const callToast = document.querySelector("#saveChangesBtn");

        callToast.addEventListener("click", () => {
            showToast({
                message: "Changes Saved.",
                icon: `<svg class="size-5 text-teal-400" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                            d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                    </svg>`,
                duration: 3000
            });
        });
    });
</script>

<script type="module">
    import { javaURI, fetchOptions } from '{{site.baseurl}}/assets/js/api/config.js';
    import { pythonURI } from '{{site.baseurl}}/assets/js/api/config.js';
    import { putUpdate, postUpdate, deleteData, logoutUserJava } from "{{site.baseurl}}/assets/js/api/profile.js";

    // this runs on page load
    document.addEventListener("DOMContentLoaded", async () => {
        try {
            await window.loadUserData();
        } catch (error) {
            console.error("Error initializing user data:", error.message);
        }
    });

    // Function to continuously fetch user data until all values are loaded
    async function continuouslyLoadUserData() {
        const nameInput = document.getElementById("nameChangeInput");
        const uidInput = document.getElementById("uidChangeInput");
        const emailInput = document.getElementById("emailChangeInput");

        // Helper function to check if all values are loaded
        function isDataLoaded() {
            return (
                nameInput.value !== "Loading name..." &&
                uidInput.value !== "Loading UID..." &&
                emailInput.value !== "Loading email..."
            );
        }

        // Retry logic
        async function fetchAndUpdateData() {
            try {
                // Fetch name and UID from Python backend
                const name = await window.fetchName();
                const uid = await window.fetchUid();

                // Fetch email from Java backend
                const email = await window.fetchEmail();

                // Update placeholders if data is available
                if (name) nameInput.value = name;
                if (uid) uidInput.value = uid;
                if (email) emailInput.value = email;

                // Log success if all data is loaded
                if (isDataLoaded()) {
                    console.log("All user data loaded successfully.");
                    return; // Stop retrying
                }
            } catch (error) {
                console.error("Error fetching user data:", error.message);
            }

            // Retry after 3 seconds if data is still not fully loaded
            setTimeout(fetchAndUpdateData, 3000);
        }

        // Start the first fetch attempt
        fetchAndUpdateData();
    }

    // Call the function on page load
    document.addEventListener("DOMContentLoaded", continuouslyLoadUserData);

    // make it run constantly to check for esc key press
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            document.getElementById('change-pfp').style.visibility = 'hidden';
            document.getElementById('change-class').style.visibility = 'hidden';
        }
    });

    // Attach the function to the global window object
    window.openChangePfpModal = function () {
        const changePfpBox = document.getElementById('change-pfp');
        console.log("Change pfp button clicked");
        if (changePfpBox) {
            changePfpBox.style.visibility = 'visible'; // Make the modal visible
        } else {
            console.error('Change PFP modal not found in the DOM.');
        }
    };

    window.changeProfilePictureWithPath = async function (imagePath) {
        try {
            // Fetch the image and convert it to a Blob
            const response = await fetch(imagePath);
            const blob = await response.blob();

            // Convert the Blob to a base64 string
            const base64String = await convertToBase64(blob);

            // Send the base64 image to the backend
            await sendProfilePicture(base64String);
            console.log('Profile picture updated to steve.png successfully!');
        } catch (error) {
            console.error('Error updating profile picture to steve.png:', error.message);
        }
    };

    // loading the user data to display
    window.loadUserData = async function () {
        try {
            // fetch all profile data at once
            const [name, uid, email, kasm] = await window.fetchProfileData();

            // update the name, uid, and email placeholders
            const nameInput = document.getElementById("nameChangeInput");
            const uidInput = document.getElementById("uidChangeInput");
            const emailInput = document.getElementById("emailChangeInput");
            const kasmCheckbox = document.getElementById("kasmChangeInput");

            if (name) {
                nameInput.value = name;
            } else {
                nameInput.value = "Failed to load name. Are you logged in?";
            }

            if (uid) {
                uidInput.value = uid;
            } else {
                uidInput.value = "Failed to load uid. Are you logged in?";
            }

            if (email) {
                emailInput.value = email;
            } else {
                emailInput.value = "Failed to load email. Are you logged in?";
            }

            // update the kasm status
            
            if (kasmCheckbox) {
                kasmCheckbox.checked = kasm;
                document.getElementById("kasm").textContent = kasm ? "kasm enabled" : "kasm disabled";
            } else {
                console.error("kasm checkbox not found in the dom.");
            }
        } catch (error) {
            console.error("error setting placeholders:", error.message);
        }
    };

    // get the data (not the same as loading because the load function changes the html)
    window.fetchProfileData = async function () {
        // api urls for fetching data
        const pythonURL = pythonURI + "/api/id";
        const javaURL = javaURI + "/api/person/get";

        let name = null;
        let uid = null;
        let email = null;
        let kasmServerNeeded = null;

        // fetch the python data first (name & uid)
        try {
            const pythonResponse = await fetch(pythonURL, fetchOptions);
            if (pythonResponse.ok) {
                const pythonData = await pythonResponse.json();

                // set data
                name = pythonData.name;
                uid = pythonData.uid;
            } else {
                console.error('error fetching name or uid:', pythonResponse.status);
            }
        } catch (error) {
            console.error('error fetching name or uid:', error.message);
        }

        // get the java data next (email & kasm)
        try {
            const javaResponse = await fetch(javaURL, fetchOptions);
            if (javaResponse.ok) {
                const javaData = await javaResponse.json();

                // set the data
                email = javaData.email;
                kasmServerNeeded = userData.kasmServerNeeded
            } else {
                console.error('error fetching email or kasm:', javaResponse.status);
            }
        } catch (error) {
            console.error('error fetching email or kasm:', error.message);
        }

        return [name, uid, email, kasmServerNeeded]; // return it all in an array
    }

    window.changeClass = async function (event) {
        event.preventDefault(); // Prevent the form from refreshing the page
        // change the class info p box
        const classInput = document.getElementById("classInput").value;
        const classInputYear = document.getElementById("classInputYear").value;
        const classDisplayedInfo = document.getElementById("classDisplayedInfo");
        classDisplayedInfo.textContent = classInput + " " + classInputYear;
    }


    window.changeProfilePicture = async function (event) {
        event.preventDefault(); // Prevent the form from refreshing the page

        // select the file
        const fileInput = document.getElementById('profilePictureInput');
        const file = fileInput.files[0];

        // all this does is update the image in the sidebar (doesnt actually send img to backend)
        if (file) {
            const reader = new FileReader();
            reader.onload = function () {
                const profileImageBox = document.getElementById('headerPfp');
                profileImageBox.innerHTML = `<img src="${reader.result}" alt="Profile Picture">`;
            };
            reader.readAsDataURL(file);
        }
        if (!file) return;

        // this is the code that ACTUALLY sends the file to the backend
        try {
            const base64String = await convertToBase64(file);
            await sendProfilePicture(base64String);
            console.log('Profile picture uploaded successfully!');
        } catch (error) {
            console.error('Error uploading profile picture:', error.message);
        }

        await new Promise(resolve => setTimeout(resolve, 250));
        window.location.reload();
    }

    // helper function to convert a file to base64 for payload
    async function convertToBase64(fileOrBlob) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
            reader.readAsDataURL(fileOrBlob);
        });
    }

    async function sendProfilePicture(base64String) {
        const URL = javaURI + "/api/person/update"; // Adjust endpoint as needed

        // Create options object for PUT request
        const options = {
            URL,
            body: { pfp: base64String },
            message: 'profile-message', // Adjust the message area as needed
            callback: () => {
                console.log('Profile picture uploaded successfully!');
            }
        };

        try {
            await postUpdate(options);
        } catch (error) {
            console.error('Error uploading profile picture:', error.message);
        }
    }
</script>

<script>
    // Store original form values
    let originalValues = {};
    let formChanged = false;

    // how long toast stays (ms)
    const toastDuration = 10000;

    // Initialize the form
    document.addEventListener('DOMContentLoaded', function () {
        // Store original values
        saveOriginalValues();

        // Set up toggle switch
        const toggle = document.querySelector('#kasmToggle');
        const toggleDot = document.querySelector('.dot');

        toggle.addEventListener('change', function () {
            if (this.checked) {
                toggleDot.classList.add('translate-x-3');
                toggle.classList.add('bg-blue-600');
            } else {
                toggleDot.classList.remove('translate-x-3');
                toggle.classList.remove('bg-blue-600');
            }
        });

        // Set up beforeunload event
        window.addEventListener('beforeunload', function (e) {
            if (formChanged) {
                showUnsavedChangesAlert();
            }
        });
    });

    // Save original form values
    function saveOriginalValues() {
        const form = document.getElementById('profileSettingsForm');
        const inputs = form.querySelectorAll('input, select');

        inputs.forEach(input => {
            if (input.type === 'checkbox') {
                originalValues[input.id] = input.checked;
            } else {
                originalValues[input.id] = input.value;
            }
        });

        // Save original class entries
        const classEntries = document.querySelectorAll('.class-entry');
        originalValues.classEntries = [];

        classEntries.forEach((entry, index) => {
            originalValues.classEntries[index] = {
                name: entry.querySelector('.class-name').value,
                year: entry.querySelector('.class-year').value
            };
        });
    }

    // Check if form values have changed
    function checkForChanges() {
        const form = document.getElementById('profileSettingsForm');
        const inputs = form.querySelectorAll('input, select');
        const saveButton = document.getElementById('saveChangesBtn');

        formChanged = false;

        // Check standard inputs
        inputs.forEach(input => {
            if (input.type === 'checkbox') {
                if (originalValues[input.id] !== input.checked) {
                    formChanged = true;
                }
            } else if (input.id && originalValues[input.id] !== undefined) {
                if (originalValues[input.id] !== input.value) {
                    formChanged = true;
                }
            }
        });

        // Check class entries
        const classEntries = document.querySelectorAll('.class-entry');
        if (classEntries.length !== originalValues.classEntries.length) {
            formChanged = true;
        } else {
            classEntries.forEach((entry, index) => {
                const name = entry.querySelector('.class-name').value;
                const year = entry.querySelector('.class-year').value;

                if (index >= originalValues.classEntries.length ||
                    originalValues.classEntries[index].name !== name ||
                    originalValues.classEntries[index].year !== year) {
                    formChanged = true;
                }
            });
        }

        // Update save button
        if (formChanged) {
            saveButton.disabled = false;
            saveButton.classList.remove('bg-neutral-300', 'text-neutral-500', 'cursor-not-allowed');
            saveButton.classList.add('bg-indigo-500', 'text-white', 'hover:bg-indigo-600');
        } else {
            saveButton.disabled = true;
            saveButton.classList.add('bg-neutral-300', 'text-neutral-500', 'cursor-not-allowed');
            saveButton.classList.remove('bg-indigo-500', 'text-white', 'hover:bg-indigo-600');
        }
    }

    // Add new class
    function addClass() {
        const container = document.getElementById('classesContainer');
        const classEntry = document.createElement('div');
        classEntry.className = 'class-entry mb-4 p-4 border border-gray-700 rounded-lg';

        classEntry.innerHTML = `
                    <div class="flex flex-col md:flex-row md:space-x-4 mb-2">
                        <div class="flex-grow mb-2 md:mb-0">
                            <label class="block text-sm font-medium text-neutral-300 mb-1">Class Name</label>
                            <input type="text" 
                                class="class-name w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="Enter class name" onchange="checkForChanges()">
                        </div>
                        <div class="w-full md:w-1/3">
                            <label class="block text-sm font-medium text-neutral-300 mb-1">Year</label>
                            <select class="class-year w-full px-4 py-2 rounded-lg border border-gray-600 bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" onchange="checkForChanges()">
                                <option>2025</option>
                                <option>2026</option>
                                <option>2027</option>
                                <option>2028</option>
                            </select>
                        </div>
                    </div>
                    <button type="button" class="text-red-500 hover:text-red-700 text-sm font-medium" onclick="removeClass(this)">
                        Remove
                    </button>
                `;

        container.appendChild(classEntry);
        checkForChanges();
    }

    // Remove class
    function removeClass(button) {
        const classEntry = button.closest('.class-entry');
        classEntry.remove();
        checkForChanges();
    }

    // show toast, auto-hide, allow manual close
    function showUnsavedChangesAlert() {
        const saveButton = document.getElementById('saveChangesBtn');

        // trigger reflow so shake always retriggers
        saveButton.classList.remove('shake-animation');
        void saveButton.offsetWidth;
        saveButton.classList.add('shake-animation');

    }

    // save all changes in one go
    async function saveChanges() {
        // get references to inputs
        const nameInput = document.getElementById("nameChangeInput");
        const uidInput = document.getElementById("uidChangeInput");
        const emailInput = document.getElementById("emailChangeInput");
        const passwordInput = document.getElementById("password");
        const kasmInput = document.getElementById("kasmChangeInput");

        // get values
        const name = nameInput.value.trim();
        const uid = uidInput.value.trim();
        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();
        const kasmServerNeeded = kasmInput ? kasmInput.checked : undefined;

        // get class info
        const classEntries = Array.from(document.querySelectorAll('.class-entry')).map(entry => ({
            name: entry.querySelector('.class-name').value,
            year: entry.querySelector('.class-year').value
        }));

        // import api helpers
        const { putUpdate, postUpdate } = await import("{{site.baseurl}}/assets/js/api/profile.js");
        const { javaURI, pythonURI } = await import("{{site.baseurl}}/assets/js/api/config.js");

        // track if we need to reload or logout
        let needsReload = false;
        let needsLogout = false;

        // save name (both backends)
        if (name && name !== originalValues["nameChangeInput"]) {
            try {
                await Promise.all([
                    putUpdate({
                        URL: pythonURI + "/api/user",
                        body: { name },
                        message: 'name-message'
                    }),
                    postUpdate({
                        URL: javaURI + "/api/person/update",
                        body: { name }
                    })
                ]);
                needsReload = true;
            } catch (e) {
                console.error("error saving name:", e.message);
            }
        }

        // save uid (python only, logs out)
        if (uid && uid !== originalValues["uidChangeInput"]) {
            try {
                await putUpdate({
                    URL: pythonURI + "/api/user",
                    body: { uid },
                    message: 'uid-message'
                });
                needsLogout = true;
            } catch (e) {
                console.error("error saving uid:", e.message);
            }
        }

        // save email (java only)
        if (email && email !== originalValues["emailChangeInput"]) {
            try {
                await postUpdate({
                    URL: javaURI + "/api/person/update",
                    body: { email }
                });
            } catch (e) {
                console.error("error saving email:", e.message);
            }
        }

        // save password (python only, logs out)
        if (password) {
            try {
                await putUpdate({
                    URL: pythonURI + "/api/user",
                    body: { password },
                    message: 'password-message'
                });
                needsLogout = true;
            } catch (e) {
                console.error("error saving password:", e.message);
            }
        }

        // save kasm server status (java only)
        if (
            typeof kasmServerNeeded !== "undefined" &&
            kasmServerNeeded !== originalValues["kasmChangeInput"]
        ) {
            try {
                await postUpdate({
                    URL: javaURI + "/api/person/update",
                    body: { kasmServerNeeded }
                });
            } catch (e) {
                console.error("error saving kasm server status:", e.message);
            }
        }

        // save classes (implement as needed)
        // you can add your own logic here to send classEntries to backend

        // update original values and ui
        saveOriginalValues();
        formChanged = false;

        const saveButton = document.getElementById('saveChangesBtn');
        saveButton.disabled = true;
        saveButton.classList.add('bg-neutral-300', 'text-neutral-500', 'cursor-not-allowed');
        saveButton.classList.remove('bg-indigo-500', 'text-white', 'hover:bg-indigo-600');

        // show success message
        const originalButtonText = saveButton.innerHTML;
        saveButton.innerHTML = `
            <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            Saved!
        `;

        setTimeout(() => {
            saveButton.innerHTML = originalButtonText;
        }, 2000);

        // handle reload or logout if needed
        if (needsLogout) {
            alert("you updated your github id or password, so you will be logged out. remember your new credentials!");
            window.location.href = '{{site.baseurl}}/duallogin';
        } else if (needsReload) {
            window.location.reload();
        }
    }
</script>